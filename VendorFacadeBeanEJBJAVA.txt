package ejbs;

import dtos.VendorEJBDTO;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import javax.ejb.LocalBean;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;
import javax.validation.ConstraintViolation;
import javax.validation.ConstraintViolationException;
import models.VendorsModel;

/**
 * VendorFacadeBean.java
 *
 * Created: 9-10-2015 3:03 PM
 *
 * @author: Evan Stateless Session EJB that acts as a facade to the Vendor
 *          model. Employs transaction control for the add method Revisions: 
 * @version 1.0 
 * 09/10/14:
 *
 */
@Stateless
@LocalBean
public class VendorFacadeBean {

    @PersistenceContext
    private EntityManager em;

    /**
     *
     * @param ven vendor DTO of all new vendor information
     * @return int representing the number of rows added. Note vendor no is an
     * auto generated number.
     */
    public int addVendor(VendorEJBDTO ven) {

        VendorsModel vm;
        int retVal = -1;

        try {
            vm = new VendorsModel(null, ven.getAddress1(), ven.getCity(),
                    ven.getProvince(), ven.getPostalcode(),
                    ven.getPhone(), ven.getVendortype(), ven.getName(),
                    ven.getEmail());
            em.persist(vm);
            em.flush();
            retVal = vm.getVendorno();
        } catch (ConstraintViolationException v) { 
            Set<ConstraintViolation<?>> coll = v.getConstraintViolations(); 
            coll.stream().forEach((s) -> {
                System.out.println(s.getPropertyPath() + " " + s.getMessage());
            });
        } catch (Exception e) {        
            System.out.println(e.getMessage());
        }
        return retVal;
    }  
 }